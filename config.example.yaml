app:
  env: "local"
  name: "ichi-go"
  version: "1.0.0"
  debug: true
  locale: "en"

api:
  versioning:
    enabled: true
    strategy: "date"
    default_version: "202601"
    supported_versions: [ "202511", "202512", "202601" ]
    deprecation:
      # Enable deprecation warning headers
      header_enabled: true
      # Days before sunset to start showing warnings
      sunset_notification_days: 90

http:
  timeout: 10000
  port: 8080
  cors:
    allow_origins: ["*"]

http-client:
  timeout: 10000
  retry_count: 10
  retry_wait_time: 20000
  retry_max_wait: 60000
  logger_enabled: false

web:
  port: 8081

database:
  driver: "mysql"
  host: "localhost"
  port: 3306
  user: "root"
  password: "password"
  name: "mydb"
  max_idle_conns: 10
  max_open_conns: 100
  max_conn_life_time: 3600
  debug: true

cache:
  driver: "redis"
  client_name: "ichigo-cache"
  host: "localhost"
  port: 6379
  password: ""
  username: ""
  db: 0
  pool_size: 20
  timeout: 10000
  use_tls: false
  skip_verify: false

log:
  level: "debug"
  pretty: true
  request_logging:
    enabled: true
    driver: "builtin"
  requestId:
    driver: "builtin"

validator:
  default_language: "en"
  supported_languages:
    - "en"
    - "id"

auth:
  jwt:
    enabled: true
    signing_method: "HS256"
    secret_key: "dev-secret-key-change-in-production"
    token_lookup: "header:Authorization,query:token"
    auth_scheme: "Bearer"
    issuer: "myapp-dev"
    audience:
      - "myapp-dev-users"
    require_claims:
      - "sub"
      - "exp"
    access_token_ttl: "1h"    # Longer for development
    refresh_token_ttl: "720h" # 30 days for development
    leeway_duration: "5m"     # More lenient for dev
    skip_paths:
      - "/health"
      - "/health/live"
      - "/health/ready"
      - "/api/v1/auth/*"
      - "/api/v1/public/*"
      - "/swagger/*"
      - "/debug/*"
      - "/docs/*"
    private_key: "path to private key"
    public_key: "path to public key"

# =============================================================================
# RBAC Configuration (Role-Based Access Control)
# =============================================================================
rbac:
  # Deployment mode determines how tenant isolation works
  # - "multi_tenant": Strict tenant isolation, tenant_id required in all requests
  # - "single_tenant": Auto-inject default tenant, simplified for admin tools
  # - "hybrid": Optional tenant_id with fallback to default (RECOMMENDED)
  mode: "hybrid"

  # Default tenant used in single_tenant and hybrid modes
  # When tenant_id is not provided, this value is used
  default_tenant: "system"

  # Path to Casbin RBAC model configuration
  model_path: "config/rbac_model.conf"

  # Performance tuning
  performance:
    # Loading strategy for policies
    # - "full": Load all policies into memory (best for single-tenant/small deployments)
    # - "filtered": Load only specific tenant policies (best for multi-tenant)
    # - "adaptive": Auto-switch based on policy count (switches at adaptive_threshold)
    loading_strategy: "filtered"

    # How long filtered policies stay in enforcer before reload
    filtered_ttl: "10m"

    # Max concurrent permission checks
    max_concurrent: 50

    # Threshold for adaptive mode (policy count)
    # If total policies < threshold, use "full", else use "filtered"
    adaptive_threshold: 5000

  # Multi-tier caching configuration
  cache:
    # Enable/disable all caching (set false for debugging)
    enabled: true

    # L1 in-memory cache TTL (LRU cache)
    memory_ttl: "60s"

    # L2 Redis cache TTL (with LZ4 compression)
    redis_ttl: "5m"

    # Max entries in L1 memory cache
    max_size: 10000

    # Enable LZ4 compression for Redis cache
    compression: true

  # Audit logging for compliance (SOC2/GDPR)
  audit:
    # Enable/disable audit logging
    enabled: true

    # Log every CheckPermission call (HIGH VOLUME - use for debugging only)
    # For production, use sample_rate instead
    log_decisions: false

    # Log policy/role changes (RECOMMENDED for compliance)
    log_mutations: true

    # Retention period in days (2555 = 7 years for SOC2 compliance)
    retention_days: 2555

    # Anonymize PII (hash email addresses with SHA-256 for GDPR)
    anonymize_pii: true

    # Sample rate for decision logging (0.0 - 1.0)
    # 0.01 = log 1% of permission checks, 1.0 = log all
    sample_rate: 0.01

  # Feature flags for optional functionality
  features:
    # Enable time-bound role assignments with auto-expiration
    time_bound_roles: false

    # Enable platform admin user impersonation
    impersonation: false

    # Enable multi-party approval workflows for sensitive operations
    approval_workflows: false

    # Enable fine-grained resource-level ABAC (Attribute-Based Access Control)
    resource_level_abac: false

pkgclient:
  pokemon_api:
    base_url: "https://pokeapi.co/api/v2"
    timeout: 10000
    retry: 3

queue:
  enabled: true

  rabbitmq:
    enabled: true

    connection:
      host: "localhost"
      port: 5672
      username: "guest"
      password: "guest"
      vhost: "/"
      connection_name: "ichigo-queue"

    exchanges:
      - name: "app.events"
        type: "x-delayed-message"
        args:
          x-delayed-type: "topic"
        durable: true
        auto_delete: false
        internal: false
        no_wait: false

    publisher:
      exchange_name: "app.events"

    consumers:
      - name: "payment_handler"
        enabled: true
        queue:
          name: "order.payment.events"
          durable: true
          auto_delete: false
          exclusive: false
          no_wait: false
        exchange_name: "app.events"
        routing_keys:
          - "payment.completed"
          - "payment.failed"
          - "payment.refunded"
        prefetch_count: 50
        worker_pool_size: 10
        auto_ack: false
        exclusive: false
        consumer_tag: "payment_handler_v1"

      - name: "welcome_notifier"
        enabled: true
        queue:
          name: "user.welcome.notifications"
          durable: true
          auto_delete: false
          exclusive: false
          no_wait: false
        exchange_name: "app.events"
        routing_keys:
          - "user.welcome"
        prefetch_count: 10
        worker_pool_size: 3
        auto_ack: false
        exclusive: false
        consumer_tag: "welcome_notifier_v1"

