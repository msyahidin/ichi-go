# =============================================================================
# Casbin RBAC Model Configuration
# =============================================================================
# Description: Universal RBAC model supporting multi-tenant, single-tenant,
#              and hybrid deployments
# Features: Domain-based isolation, platform roles, wildcard support
# Author: Engineering Team
# Created: 2026-01-17
# =============================================================================

[request_definition]
# Request format: (subject, domain, object, action)
# - sub: user identifier (e.g., "user:123")
# - dom: tenant identifier (e.g., "tenant_xyz" or "system")
# - obj: resource being accessed (e.g., "products", "orders")
# - act: action being performed (e.g., "view", "create", "delete")
r = sub, dom, obj, act

[policy_definition]
# Policy format: (subject, domain, object, action)
# - sub: role name (e.g., "admin", "viewer") or user identifier
# - dom: tenant identifier or "*" for global policies
# - obj: resource or "*" for all resources
# - act: action or "*" for all actions
p = sub, dom, obj, act

[role_definition]
# g: Tenant-scoped role assignments
# Format: (user, role, tenant)
# Example: ("user:123", "admin", "tenant_xyz")
# Meaning: user:123 has role "admin" in tenant "tenant_xyz"
g = _, _, _

# g2: Global platform role assignments
# Format: (user, platform_role)
# Example: ("user:456", "platform.admin")
# Meaning: user:456 has global platform admin privileges
g2 = _, _

[policy_effect]
# Effect: Allow if at least one policy matches
# This enables additive permissions (any matching policy grants access)
e = some(where (p.eft == allow))

[matchers]
# Matching logic:
# 1. Check if subject has role via tenant-scoped (g) or global (g2) grouping
# 2. Match domain: exact match OR policy domain is wildcard (*)
# 3. Match object: exact match OR policy object is wildcard (*)
# 4. Match action: exact match OR policy action is wildcard (*)
#
# Examples:
# - g(r.sub, "admin", "tenant_a") matches p("admin", "tenant_a", "products", "write")
# - g2(r.sub, "platform.admin") matches p("platform.admin", "*", "*", "*")
# - Policy p("viewer", "tenant_a", "*", "read") matches any read action in tenant_a
m = (g(r.sub, p.sub, r.dom) || g2(r.sub, p.sub)) && \
    (r.dom == p.dom || p.dom == "*") && \
    (r.obj == p.obj || p.obj == "*") && \
    (r.act == p.act || p.act == "*")

# =============================================================================
# Usage Examples
# =============================================================================
#
# 1. Tenant-scoped admin:
#    g, user:123, admin, tenant_xyz
#    p, admin, tenant_xyz, products, write
#    → user:123 can write products in tenant_xyz
#
# 2. Platform super admin:
#    g2, user:456, platform.admin
#    p, platform.admin, *, *, *
#    → user:456 has global access to all resources
#
# 3. Wildcard permissions:
#    g, user:789, viewer, tenant_abc
#    p, viewer, tenant_abc, *, read
#    → user:789 can read any resource in tenant_abc
#
# 4. Multi-role user:
#    g, user:101, admin, tenant_a
#    g, user:101, viewer, tenant_b
#    → user:101 has different roles in different tenants
#
# 5. Cross-tenant platform admin:
#    g2, user:202, platform.impersonate
#    p, platform.impersonate, *, users, impersonate
#    → user:202 can impersonate users in any tenant
#
# =============================================================================
